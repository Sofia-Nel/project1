---
title: "Searching for mistakes"
author: "Sofia Animato"
date: "2023-11-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
library("rvest")
library("dplyr")
library("tidyr")
library("rstatix")
library("ggplot2")
library("dlookr")
library("editrules")
library("htmltools")
library("kableExtra")
library("classInt")
library("frequency")
```

## Missing Values: all the rows are complete

```{r count-demo, echo=TRUE}
sum(complete.cases(Biedronki))
nrow(Biedronki[complete.cases(Biedronki), ])/nrow(Biedronki)*100
```

## Identify outliers:

# Identified outliers for Total

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers(`Total`)
```

```{r boxplot, echo=TRUE}
boxplot(Total~Branch, data=Biedronki)
```

# Identified outliers for cogs

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers('cogs')
```

```{r boxplot, echo=TRUE}
boxplot(cogs~Branch, data=Biedronki)
```

# Identified outliers for Tax 5%

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers(`Tax 5%`)
```

# Identified outliers for gross income

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers(`gross income`)
```

## Imputate outliers and data correction

# Imputate outlier for "Total"

```{r}
Biedronki %>%
   mutate(Total_imp = imputate_outlier(Biedronki, Total, method = "capping")) %>%
  summary()
```

# Imputate outlier for "Cogs"

```{r}
Biedronki %>%
   mutate(Cogs_imp = imputate_outlier(Biedronki, cogs, method = "capping")) %>%
  summary()
```

# Imputate outlier for "Tax 5%"

```{r}
Biedronki %>%
   mutate(Tax_5_imp = imputate_outlier(Biedronki, `Tax 5%`, method = "capping")) %>%
  summary()
```

# Imputate outlier for "gross income"

```{r}
Biedronki %>%
   mutate(gross_income_imp = imputate_outlier(Biedronki, `gross income`, method = "capping")) %>%
  summary()
```

## Rules to follow

We have the following rules:

-   Gross Income must be positive.

-   The rating must be greater than 6.

```{r echo = TRUE}
RULE <- editset(c("gross_income > 0"))
```

```{r echo = TRUE}
RULE <- editset(c("Rating > 6"))
```

# How many times the rule has been violated

```{r echo = TRUE}
violated <- violatedEdits(RULE, Biedronki)
summary(violated)
```

```{r echo = TRUE}
plot(violated)
```

## Summary tables

```{r}
tabl1<-c("0-10 kPLN", "10-20 kPLN", "20-30 kPLN", "30-40 kPLN", "40-50 kPLN")
limits<-cut(Biedronki$`gross income`, seq(0,50,by=10),labels=tabl1)
table1<-freq(limits,type="html")
kbl(table1)
```


## Univariate Statistics

## Frequency Tables

##libraries

```{r}
install.packages(c('qwraps2', 'arsenal', 'e1071', 'haven', 'papeR', 'dplyr', 'tidyverse', 'kableExtra', 'summarytools', 'classInt', 'pastecs', 'reporttools', 'desctable', 'psych', 'frequency', 'ggpubr', 'ggforce', 'ggdist', 'gghalves', 'gtsummary','AER','kable'))
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
options(qwraps2_markup = "markdown")
library(qwraps2)
library(arsenal)
library(e1071)
library(haven)
library(papeR)
library(dplyr)
library(tidyverse)
library(kableExtra)
library(summarytools)
library(classInt)
library(pastecs)
library(reporttools)
library(desctable)
library(psych)
library(ggpubr)
library(ggforce)
library(ggdist)
library(gghalves)
library(gtsummary)
library(AER)
library(kableExtra)
```



```{r}
tabl1<-c("0-10 kPLN","10-20 kPLN","20-30 kPLN","30-40 kPLN","40-50 kPLN")
limits<-cut(Biedronki$`gross income`,seq(0,50,by=10),labels=tabl1)
table1<-freq(limits,type="html")
kbl(table1)
```

```{r tai, echo=FALSE}
kbl(table1,caption = "Gross income - Biedronka - values in kPLN") %>%
    kable_material(c("striped", "hover"))
tab1<-classIntervals(Biedronki$`gross income`,n=10,style="fixed",fixedBreaks=seq(0,50,by=10))
jenks.tests(tab1)
```

## Basic plots

```{r histogram, echo=FALSE}
hist(Biedronki$`gross income`, breaks="FD", col="green", probability = TRUE,
     main="Gross income in kPLN - Biedronki")
lines(density(Biedronki$`gross income`[Biedronki$City=="Yangon"]),col=2)
lines(density(Biedronki$`gross income`[Biedronki$City=="Naypyitaw"]),col=3)
lines(density(Biedronki$`gross income`[Biedronki$City=="Mandalay"]),col=4)
legend("topright", legend=c("Yagon", "Naypyitaw", "Mandalay"),
       col=c(2,3,4), lty=1:2, horiz=FALSE, box.lty=0, cex=0.8)

```

```{r boxplot, echo=FALSE}
boxplot(Biedronki$`gross income`~Biedronki$City)

```

## ggplot2 plots

```{r histogram2, echo=FALSE}
# Density plot of "price_PLN"
#::::::::::::::::::::::::::::::::::::::
density.p <- ggdensity(Biedronki, x = "gross income", 
                       fill = "City", palette = "jco")+
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Draw the summary table of price_PLN
#::::::::::::::::::::::::::::::::::::::
# Compute descriptive statistics by groups
stable <- desc_statby(Biedronki, measure.var = "gross income",
                      grps = "City")
stable <- stable[, c("City", "length", "mean", "sd")]
# Summary table plot, medium orange theme
stable.p <- ggtexttable(stable, rows = NULL, 
                        theme = ttheme("mOrange"))
# Draw text
#::::::::::::::::::::::::::::::::::::::
text <- paste("Gross income in kPLN per supermarket by 3 cities - Biedronki.",
              "Random sample of 200 Biedronki.",
               sep = " ")
text.p <- ggparagraph(text = text, face = "italic", size = 11, color = "black")
# Arrange the plots on the same page
ggarrange(density.p, stable.p, text.p, 
          ncol = 1, nrow = 3,
          heights = c(1, 0.5, 0.3))
```

## Summary tables 

```{r kable_report2, echo=FALSE, message=FALSE, warning=FALSE}
raport <-
  list("Price in kPLN" =
       list("Min"       = ~ min(Biedronki$`gross income`),
            "Max"       = ~ max(Biedronki$`gross income`),
            "Q1"        = ~ quantile(Biedronki$`gross income`,0.25),
            "Median" = ~ round(median(Biedronki$`gross income`),2),
            "Q3"        = ~ quantile(Biedronki$`gross income`,0.75),
            "Mean" = ~ round(mean(Biedronki$`gross income`),2),
            "Sd" = ~ round(sd(Biedronki$`gross income`),2),
            "IQR" = ~ round(iqr(Biedronki$`gross income`),2),
            "Sx" = ~ round(iqr(Biedronki$`gross income`)/2,2),
            "Var %" = ~ round((sd(Biedronki$`gross    income`)/mean(Biedronki$`gross income`)),2),
            "IQR Var %" = ~ round((iqr(Biedronki$`gross income`)/median(Biedronki$`gross income`)),2),
            "Skewness" = ~  round(skew(Biedronki$`gross income`),2),
            "Kurtosis" = ~  round(kurtosi(Biedronki$`gross income`),2)
            ))
tabela<-summary_table(Biedronki, summaries = raport, by = c('Payment'))

kbl(tabela, digits = 2, caption="Table 1. Biedronki - gross income in kPLN by type of payment." %>% kable_classic(full_width = F, html_font = "Cambria")%>% kable_styling(bootstrap_options = c("striped", "hover"))
```


# Data Frame summary

```{r warning=FALSE, results="asis"}
dfSummary(Biedronki,
          plain.ascii  = FALSE, 
          style        = "grid", 
          graph.magnif = 0.75, 
          valid.col    = FALSE,
          tmp.img.dir  = "/tmp")
```



























