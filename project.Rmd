---
title: "Searching for mistakes"
author: "Sofia Animato"
date: "2023-11-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
library("rvest")
library("dplyr")
library("tidyr")
library("rstatix")
library("ggplot2")
library("dlookr")
library("editrules")
library("htmltools")
library("kableExtra")
library("classInt")
library("frequency")
library("ggstatsplot")
```

## Missing Values: all the rows are complete

```{r count-demo, echo=TRUE}
sum(complete.cases(Biedronki))
nrow(Biedronki[complete.cases(Biedronki), ])/nrow(Biedronki)*100
```

#### Identify outliers:

# Identified outliers for Total

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers(`Total`)
```

```{r boxplot, echo=TRUE}
boxplot(Total~Branch, data=Biedronki)
```

# Identified outliers for cogs

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers('cogs')
```

```{r boxplot, echo=TRUE}
boxplot(cogs~Branch, data=Biedronki)
```

# Identified outliers for Tax 5%

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers(`Tax 5%`)
```

# Identified outliers for gross income

```{r}
Biedronki %>%
  group_by(Branch) %>%
  identify_outliers(`gross income`)
```

#### Imputate outliers and data correction

# Imputate outlier for "Total"

```{r}
Biedronki %>%
   mutate(Total_imp = imputate_outlier(Biedronki, Total, method = "capping")) %>%
  summary()
```

# Imputate outlier for "Cogs"

```{r}
Biedronki %>%
   mutate(Cogs_imp = imputate_outlier(Biedronki, cogs, method = "capping")) %>%
  summary()
```

# Imputate outlier for "Tax 5%"

```{r}
Biedronki %>%
   mutate(Tax_5_imp = imputate_outlier(Biedronki, `Tax 5%`, method = "capping")) %>%
  summary()
```

# Imputate outlier for "gross income"

```{r}
Biedronki %>%
   mutate(gross_income_imp = imputate_outlier(Biedronki, `gross income`, method = "capping")) %>%
  summary()
```

#### Rules to follow

We have the following rules:

-   Gross Income must be positive.

-   The rating must be greater than 6.

```{r echo = TRUE}
RULE <- editset(c("gross_income > 0"))
```

```{r echo = TRUE}
RULE <- editset(c("Rating > 6"))
```

# How many times the rule has been violated

The analysis reveals only one violation based on the specified rules. This suggests that the dataset 'Biedronki' is generally in compliance with the defined criteria.

```{r echo = TRUE}
violated <- violatedEdits(RULE, Biedronki)
summary(violated)
```

```{r echo = TRUE}
plot(violated)
```

#### Summary tables

The summary table reveals that the majority of the observations in the dataset 'Biedronki' fall within the first gross income class (0-10 kPLN). This concentration suggests that a significant portion of the data is characterized by lower gross income levels, which may affect the purchasing behaviour of costumers, thus it may be crucial for the developement of commercial and marketing strategies.

```{r}
tabl1<-c("0-10 kPLN", "10-20 kPLN", "20-30 kPLN", "30-40 kPLN", "40-50 kPLN")
limits<-cut(Biedronki$`gross income`, seq(0,50,by=10),labels=tabl1)
table1<-freq(limits,type="html")
kbl(table1)
```


# Univariate Analysis

## Frequency Tables

```{r}
install.packages(c('qwraps2', 'arsenal', 'e1071', 'haven', 'papeR', 'dplyr', 'tidyverse', 'kableExtra', 'summarytools', 'classInt', 'pastecs', 'reporttools', 'desctable', 'psych', 'frequency', 'ggpubr', 'ggforce', 'ggdist', 'gghalves', 'gtsummary','AER','kable'))
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
options(qwraps2_markup = "markdown")
library(qwraps2)
library(arsenal)
library(e1071)
library(haven)
library(papeR)
library(dplyr)
library(tidyverse)
library(kableExtra)
library(summarytools)
library(classInt)
library(pastecs)
library(reporttools)
library(desctable)
library(psych)
library(ggpubr)
library(ggforce)
library(ggdist)
library(gghalves)
library(gtsummary)
library(AER)
library(kableExtra)
```

The frequency table illustrated below allows for a quick assessment of the prevalence of income levels within the specified ranges, providing valuable insights into the dataset's economic profiles. As well as the summary table presented few lines before, it reveals that the majority of the observations in the dataset 'Biedronki' fall within the first gross income class. This should be, again, a useful information to consider while implementing strategic decisions.

```{r}
tabl1<-c("0-10 kPLN","10-20 kPLN","20-30 kPLN","30-40 kPLN","40-50 kPLN")
limits<-cut(Biedronki$`gross income`,seq(0,50,by=10),labels=tabl1)
table1<-freq(limits,type="html")
kbl(table1)
```

<<<<<<< HEAD
```{r tai, echo=FALSE}
kbl(table1,caption = "Gross income - Biedronka - values in kPLN") %>%
    kable_material(c("striped", "hover"))
tab1<-classIntervals(Biedronki$`gross income`,n=10,style="fixed",fixedBreaks=seq(0,50,by=10))
jenks.tests(tab1)
```

## Basic plots

This histogram visually represents the distribution of gross income in the 'Biedronki' dataset. The bars are colored green, and the density plots overlayed in different colors correspond to the cities Yangon, Naypyitaw, and Mandalay. The graph provides a clear depiction of the income distribution, while the density lines highlight potential variations across different cities. The legend at the top-right indicates the city corresponding to each density plot, enhancing the interpretability of the graph.

```{r histogram, echo=FALSE}
hist(Biedronki$`gross income`, breaks="FD", col="green", probability = TRUE,
     main="Gross income in kPLN - Biedronki")
lines(density(Biedronki$`gross income`[Biedronki$City=="Yangon"]),col=2)
lines(density(Biedronki$`gross income`[Biedronki$City=="Naypyitaw"]),col=3)
lines(density(Biedronki$`gross income`[Biedronki$City=="Mandalay"]),col=4)
legend("topright", legend=c("Yagon", "Naypyitaw", "Mandalay"),
       col=c(2,3,4), lty=1:2, horiz=FALSE, box.lty=0, cex=0.8)

```

This boxplot illustrates the distribution of gross income in 'Biedronki' across different cities. Each box represents the interquartile range (IQR) of income for a specific city, with the median marked by a line inside each box. The whiskers extend to the minimum and maximum values within 1.5 times the IQR. this boxplot is effective to compare the central tendency and spread of income data between different cities, providing a summary of the dataset's variation across locations.

```{r boxplot, echo=FALSE}
boxplot(Biedronki$`gross income`~Biedronki$City)

```

## Ggplot2 plots

This composite visualization effectively communicates insights into the distribution of gross income in 'Biedronki' supermarkets across three cities. The density plot provides a visual representation of the income distribution, distinguished by city with a palette of colors. The dashed red lines represent normal density overlays.

The summary table presents key descriptive statistics, including the count, mean, and standard deviation for each city. This provides a concise numerical summary of the income data within each location.

The descriptive text at the bottom adds context to the visualization, mentioning the dataset size and the focus on a random sample of 200 Biedronki supermarkets. Overall, this multifaceted approach enhances the understanding of the gross income distribution in relation to different cities in the dataset. This chart is, again, useful to implement marketing and strategic decisions, especially when it comes to market segmentation and placement of new products; with this concern, it could be the basis for further analysis on consumer's purchasing behaviour and needs based on their provenience.

```{r histogram2, echo=FALSE}
# Density plot of "price_PLN"
#::::::::::::::::::::::::::::::::::::::
density.p <- ggdensity(Biedronki, x = "gross income", 
                       fill = "City", palette = "jco")+
  stat_overlay_normal_density(color = "red", linetype = "dashed")

# Draw the summary table of price_PLN
#::::::::::::::::::::::::::::::::::::::
# Compute descriptive statistics by groups
stable <- desc_statby(Biedronki, measure.var = "gross income",
                      grps = "City")
stable <- stable[, c("City", "length", "mean", "sd")]
# Summary table plot, medium orange theme
stable.p <- ggtexttable(stable, rows = NULL, 
                        theme = ttheme("mOrange"))
# Draw text
#::::::::::::::::::::::::::::::::::::::
text <- paste("Gross income in kPLN per supermarket by 3 cities - Biedronki.",
              "Random sample of 200 Biedronki.",
               sep = " ")
text.p <- ggparagraph(text = text, face = "italic", size = 11, color = "black")
# Arrange the plots on the same page
ggarrange(density.p, stable.p, text.p, 
          ncol = 1, nrow = 3,
          heights = c(1, 0.5, 0.3))
```


## Summary tables 

### summary table 1, interpretation: 

The statistics for gross income across different payment types at Biedronki are exactly the same. This suggests a high degree of uniformity in the distribution of gross income, with no significant variations observed between the payment categories. All measures of central tendency (mean, median) and variability (standard deviation, interquartile range) exhibit identical values for each payment type. Additionally, skewness and kurtosis, indicating the shape of the distribution, show no discernible differences. In summary, the gross income profiles across payment types appear to be remarkably consistent based on the provided statistical analysis.

```{r kable_report2, echo=FALSE, message=FALSE, warning=FALSE}
Biedronki$Payment <- factor(Biedronki$Payment)

raport1 <-
  list("Price in kPLN" =
       list("Min"       = ~ min(Biedronki$`gross income`),
            "Max"       = ~ max(Biedronki$`gross income`),
            "Q1"        = ~ quantile(Biedronki$`gross income`,0.25),
            "Median" = ~ round(median(Biedronki$`gross income`),2),
            "Q3"        = ~ quantile(Biedronki$`gross income`,0.75),
            "Mean" = ~ round(mean(Biedronki$`gross income`),2),
            "Sd" = ~ round(sd(Biedronki$`gross income`),2),
             "IQR" = ~ round(iqr(Biedronki$`gross income`),2),
            "Sx" = ~ round(iqr(Biedronki$`gross income`)/2,2),
            "Var %" = ~ round((sd(Biedronki$`gross income`)/mean(Biedronki$`gross income`)),2),
            "IQR Var %" = ~ round((iqr(Biedronki$`gross income`)/median(Biedronki$`gross income`)),2),
            "Skewness" = ~  round(skew(Biedronki$`gross income`),2),
            "Kurtosis" = ~  round(kurtosi(Biedronki$`gross income`),2)
            ))
tabela1<-summary_table(Biedronki, summaries = raport1, by = c('Payment'))

kbl(tabela1, digits = 3,
  caption="Table 1. Biedronki - gross income in kPLN by type of payment.") %>% kable_classic(full_width = F, html_font = "Cambria")%>% kable_styling(bootstrap_options = c("striped", "hover"))
```

### summary table 2, interpretation:

The statistics presented in Table 2 reveal a remarkable consistency in the gross income profiles across different customer types at Biedronki. All key measures of central tendency, including mean and median, show identical values for each customer category. Similarly, measures of variability such as standard deviation (Sd) and interquartile range (IQR), as well as distribution characteristics like skewness and kurtosis, exhibit no differences.The lack of variability across customer types suggests that customers, irrespective of their type, have similar financial behaviors or contribute equally to the gross income distribution at Biedronki.

In summary, the consistent statistical results imply a homogeneous gross income distribution across different customer types, providing valuable insights for Biedronki's understanding of its customer base and informing business strategies accordingly.
 
```{r kable_report2, echo=FALSE, message=FALSE, warning=FALSE}
raport2 <-
  list("Price in kPLN" =
       list("Min"       = ~ min(Biedronki$`gross income`),
            "Max"       = ~ max(Biedronki$`gross income`),
            "Q1"        = ~ quantile(Biedronki$`gross income`,0.25),
            "Median" = ~ round(median(Biedronki$`gross income`),2),
            "Q3"        = ~ quantile(Biedronki$`gross income`,0.75),
            "Mean" = ~ round(mean(Biedronki$`gross income`),2),
            "Sd" = ~ round(sd(Biedronki$`gross income`),2),
             "IQR" = ~ round(iqr(Biedronki$`gross income`),2),
            "Sx" = ~ round(iqr(Biedronki$`gross income`)/2,2),
            "Var %" = ~ round((sd(Biedronki$`gross income`)/mean(Biedronki$`gross income`)),2),
            "IQR Var %" = ~ round((iqr(Biedronki$`gross income`)/median(Biedronki$`gross income`)),2),
            "Skewness" = ~  round(skew(Biedronki$`gross income`),2),
            "Kurtosis" = ~  round(kurtosi(Biedronki$`gross income`),2)
            ))
tabela2<-summary_table(Biedronki, summaries = raport2, by = c('Customer type'))

kbl(tabela2, digits = 2,
  caption="Table 2. Biedronki - gross income in kPLN by type of payment.") %>% kable_classic(full_width = F, html_font = "Cambria")%>% kable_styling(bootstrap_options = c("striped", "hover"))
```
 
### summary table 3, interpretation:

The statistics presented in Table 3 reveal, again, a consistency in the gross income profiles across different product lines at Biedronki. All key measures of central tendency, including mean and median, show identical values for each product line. The measures of variability such as standard deviation and interquartile range, as well as distribution characteristics like skewness and kurtosis, exhibit no differences at all. The absence of variability in these results across product lines suggests, same as for the costumer types, a uniformity in the financial dynamics of gross income. Product lines seem to contribute equally to the gross income distribution at Biedronki.

This uniformity of gross income distribution across different product lines, may have implications for strategic decision-making, inventory management, and marketing strategies, as the financial patterns do not exhibit significant distinctions among product categories.

``````{r kable_report2, echo=FALSE, message=FALSE, warning=FALSE}
Biedronki$Payment <- factor(Biedronki$Payment)

raport3 <-
  list("Price in kPLN" =
       list("Min"       = ~ min(Biedronki$`gross income`),
            "Max"       = ~ max(Biedronki$`gross income`),
            "Q1"        = ~ quantile(Biedronki$`gross income`,0.25),
            "Median" = ~ round(median(Biedronki$`gross income`),2),
            "Q3"        = ~ quantile(Biedronki$`gross income`,0.75),
            "Mean" = ~ round(mean(Biedronki$`gross income`),2),
            "Sd" = ~ round(sd(Biedronki$`gross income`),2),
             "IQR" = ~ round(iqr(Biedronki$`gross income`),2),
            "Sx" = ~ round(iqr(Biedronki$`gross income`)/2,2),
            "Var %" = ~ round((sd(Biedronki$`gross income`)/mean(Biedronki$`gross income`)),2),
            "IQR Var %" = ~ round((iqr(Biedronki$`gross income`)/median(Biedronki$`gross income`)),2),
            "Skewness" = ~  round(skew(Biedronki$`gross income`),2),
            "Kurtosis" = ~  round(kurtosi(Biedronki$`gross income`),2)
            ))
tabela3<-summary_table(Biedronki, summaries = raport3, by = c('Product line'))

kbl(tabela3, digits = 3,
  caption="Table 3. Biedronki - gross income in kPLN by type of product line.") %>% kable_classic(full_width = F, html_font = "Cambria")%>% kable_styling(bootstrap_options = c("striped", "hover"))

```
 
## Distribution of gross income with a breakdown by product lines:

This histogram offers insights into the distribution of gross income in 'Biedronki' with a breakdown by product lines. The green bars represent the overall distribution, while overlaid density plots in different colors correspond to specific product lines, including Electronic accessories, Fashion accessories, and Food and beverages. The legend at the top-right facilitates interpretation by associating each density plot with its respective product line.

This visualization effectively compares the income distribution across various product categories, providing a visual understanding of how different types of products contribute to the overall gross income. 

```{r histogram, echo=FALSE}
hist(Biedronki$`gross income`, breaks="FD", col="green", probability = TRUE,
     main="Gross income in kPLN - Biedronki")
lines(density(Biedronki$`gross income`[Biedronki$`Product line`=="Electronic accessories"]),col=2)
lines(density(Biedronki$`gross income`[Biedronki$`Product line`=="Fashion accessories"]),col=3)
lines(density(Biedronki$`gross income`[Biedronki$`Product line`=="Food and beverages"]),col=4)
legend("topright", legend=c("Electronic accessories", "Fashion accessories", "Food and beverages"),
       col=c(2,3,4), lty=1:2, horiz=FALSE, box.lty=0, cex=0.8)
```


## Data Frame summary

This is a comprehensive summary report for the 'Biedronki' dataset using the dfSummary function. The report includes various statistics and visualizations, it is a valuable tool for initial exploratory data analysis, offering insights into data distributions, missing values, and other key attributes. Overall, this approach facilitates a quick and thorough understanding of the dataset's structure and content.

```{r warning=FALSE, results="asis"}
dfSummary(Biedronki,
          plain.ascii  = FALSE, 
          style        = "grid", 
          graph.magnif = 0.75, 
          valid.col    = FALSE,
          tmp.img.dir  = "/tmp")
```

# Statistical inference
 
## Gross income and City

This plot provides a clear overview of how the distribution of gross income varies between cities. This type of visualization is valuable for identifying potential differences or patterns in income levels across different locations, aiding in the exploration of geographical variations within the dataset. We can conlcude that gross income is not significant different in cities.

```{r}
Biedronki$City <- as.factor(Biedronki$City)
Biedronki$income <- as.numeric(Biedronki$`gross income`)

ggbetweenstats(
  data  = Biedronki,
  y     = income,
  x     = City,
  title = "Distribution of Gross Income  across City"
)
```
 
 
## Rating and Customer type 

The resulting plot provides a clear overview of how the distribution of ratings varies between customer types. This type of visualization is valuable for identifying potential differences or patterns in ratings across different customer segments, aiding in the exploration of customer preferences within the dataset. we can conclude that Rating is not significant different by customer type. 

```{r}
Biedronki$Customer <- as.factor(Biedronki$`Customer type`)
Biedronki$Rating <- as.numeric(Biedronki$Rating)

ggbetweenstats(
  data  = Biedronki,
  y     = Rating,
  x     = Customer,
  title = "Distribution of Rating across Customer Type"
)
```

## Quantatity and Gender

The resulting plot provides a clear overview of how the distribution of quantity varies between genders. This type of visualization is valuable for identifying potential differences or patterns in purchasing behavior across different gender groups, aiding in the exploration of gender-related variations within the dataset.Our conclusion is that Quantity, thus number of products purchased by the customer, is significant different by gender. Indeed, women buy more products on average than men.


```{r}
Biedronki$Gender <- as.factor(Biedronki$Gender)
Biedronki$Quantity <- as.numeric(Biedronki$Quantity)

ggbetweenstats(
  data  = Biedronki,
  y     = Quantity,
  x     = Gender,
  title = "Distribution of quantatity across gender"
)
```

## Unit price and Product Line

The resulting plot provides a clear overview of how the distribution of unit prices varies across different product lines. This type of visualization is valuable for identifying potential differences or patterns in pricing strategies across product categories, aiding in the exploration of pricing dynamics within the dataset. however, we can conclude that in this case unit price of each product is not significant different by product line. 

```{r}
Biedronki$Line <- as.factor(Biedronki$`Product line`)
Biedronki$Unit <- as.numeric(Biedronki$`Unit price`)

ggbetweenstats(
  data  = Biedronki,
  y     = Unit,
  x     = Line,
  title = "Distribution of unit price across product line"
)
```

 
# Bivariate Analysis (Correlation)

This analysis creates a correlation matrix plot for the 'Biedronki' dataset. It provides a visual representation of the correlation coefficients. This type of plot is valuable for quickly assessing relationships and dependencies between variables in the dataset. white squares indicate no or weak correlation, we have them mostly for "rating" and "quality", as well as some for "income" and "unit". With regard to the cases in which we have correlation that equals to 1, it indicates a perfect positive linear relationship between the variables. This means that as one variable increases, the other variable also increases proportionally. The variables are perfectly aligned on a straight line. As far as the cases in which correlation equals to 0.63 or 0.71, it indicates a moderately strong positive linear relationship between two variables. The positive sign suggests that as one variable increases, there is a tendency for the other variable to increase as well, but not perfectly.
 
```{r}
ggcorrmat(
  data     = Biedronki,
  colors   = c("#B2182B", "white", "#4D4D4D"),
  title    = "Correlalogram for Biedronki dataset",
)
```


























